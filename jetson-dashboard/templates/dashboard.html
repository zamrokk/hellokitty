<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jetson Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://media2.giphy.com/media/Bng6O8FwfWbEHIdGsE/giphy-preview.gif" alt="Hello Kitty" class="hello-kitty-gif">
            <h1>üéÄ Hello Kitty Dashboard üéÄ</h1>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">Mod√®le</div>
                <div class="status-value" id="model">Chargement...</div>
            </div>
            <div class="status-item">
                <div class="status-label">Architecture</div>
                <div class="status-value" id="architecture">Chargement...</div>
            </div>
            <div class="status-item">
                <div class="status-label">Uptime</div>
                <div class="status-value" id="uptime">Chargement...</div>
            </div>
            <div class="status-item">
                <div class="status-label">Derni√®re MAJ</div>
                <div class="status-value" id="lastUpdate">Chargement...</div>
            </div>
        </div>

        <div class="grid">
            <!-- Unified Memory Card -->
            <div class="card">
                <h3>üíæ M√©moire Unifi√©e (CPU+GPU)</h3>
                <div class="metric">
                    <span class="metric-label">Utilis√©e</span>
                    <span class="metric-value" id="ramUsed">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Totale</span>
                    <span class="metric-value" id="ramTotal">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Pourcentage</span>
                    <span class="metric-value" id="ramPercent">-</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="ramProgress"></div>
                </div>
             
            </div>

            <!-- CPU Card -->
            <div class="card">
                <h3>‚ö° Processeur ARM Cortex-A78AE</h3>
                <div class="metric">
                    <span class="metric-label">Utilisation moyenne</span>
                    <span class="metric-value" id="cpuAverage">-</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cpuProgress"></div>
                </div>
                <div style="margin-top: 10px; font-size: 0.9em; color: #ff69b4; text-align: center; font-weight: bold;">
                    üèóÔ∏è 6 c≈ìurs ARMv8 (2 clusters √ó 3 c≈ìurs)<br>
                    üîÑ Architecture big.LITTLE
                </div>
            </div>


            <!-- Temperature Card -->
            <div class="card">
                <h3>üå°Ô∏è Temp√©ratures</h3>
                <div class="metric">
                    <div class="metric-label">CPU</div>
                    <div class="metric-value" id="tempCpu">-</div>
                </div>
                <div class="metric">
                    <div class="metric-label">GPU</div>
                    <div class="metric-value" id="tempGpu">-</div>
                </div>
            </div>

        </div>

        <!-- AI Statistics Card - Full Width (outside grid) -->
        <div class="card full-width">
            <h3>üß† AI Statistics</h3>
            <div class="ai-content">
                <div class="todo-message">TODO</div>
                <div class="todo-message">TODO</div>
                <div class="todo-message">TODO</div>
                <div class="todo-message">TODO</div>

            </div>
        </div>
    </div>

    <script>
        let updateInterval;

        function updateProgressBar(elementId, percentage) {
            const progressBar = document.getElementById(elementId);
            if (progressBar) {
                progressBar.style.width = percentage + '%';
                progressBar.className = 'progress-fill';
                if (percentage > 80) {
                    progressBar.classList.add('danger');
                } else if (percentage > 60) {
                    progressBar.classList.add('warning');
                }
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function formatMB(bytes) {
            return bytes + ' MB';
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('fr-FR');
        }

        function updateDashboard(data) {
            try {
                // System info
                document.getElementById('model').textContent = data.system.model || 'NVIDIA Jetson';
                document.getElementById('architecture').textContent = data.system.architecture || 'ARM (Unified Memory)';
                document.getElementById('uptime').textContent = data.system.uptime || 'Inconnu';
                document.getElementById('lastUpdate').textContent = formatTime(data.timestamp * 1000);

                // RAM
                const ram = data.data.ram;
                document.getElementById('ramUsed').textContent = formatMB(ram.used);
                document.getElementById('ramTotal').textContent = formatMB(ram.total);
                document.getElementById('ramPercent').textContent = ram.percentage + '%';
                updateProgressBar('ramProgress', ram.percentage);

                // CPU
                const cpu = data.data.cpu;
                document.getElementById('cpuAverage').textContent = cpu.average + '%';
                updateProgressBar('cpuProgress', cpu.average);



                // Temperature
                const temp = data.data.temperature;
                document.getElementById('tempCpu').textContent = temp.cpu.toFixed(1) + '¬∞C';
                document.getElementById('tempGpu').textContent = temp.gpu.toFixed(1) + '¬∞C';


            } catch (error) {
                console.error('Error updating dashboard:', error);
                showError('Erreur lors de la mise √† jour des donn√©es');
            }
        }

        function showError(message) {
            const container = document.querySelector('.container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            container.insertBefore(errorDiv, container.firstChild);
        }

        function fetchData() {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    showError('Impossible de r√©cup√©rer les donn√©es du serveur');
                });
        }

        // Start updating every 2 seconds
        function startUpdates() {
            fetchData(); // Initial load
            updateInterval = setInterval(fetchData, 2000);
        }

        // Start the dashboard
        document.addEventListener('DOMContentLoaded', startUpdates);
    </script>
</body>
</html>
